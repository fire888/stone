!function(){"use strict";var e=function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")},t=function(){function i(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(n,e,t){return e&&i(n.prototype,e),t&&i(n,t),n}}(),n=function(){function n(){e(this,n)}return t(n,[{key:"sendSignToFindEnemy",value:function(e){$.post("/api/user/find-game").then(function(n){e(n)})}},{key:"getSignIfConnectFirst",value:function(e){$.get("/api/session/hello").done(function(n){e(n)})}},{key:"getSignAboutUpdateGameResult",value:function(e){$.get("/api/game").done(function(n){e(n)})}},{key:"sendHeroChoice",value:function(n,e){console.log(n),$.post("/api/game/move?choice="+n).then(function(n){e(n)})}},{key:"sendReadyForNextRound",value:function(e){$.post("/api/game/next-round").then(function(n){e(n)})}},{key:"postWinnerResultFatality",value:function(n,e){$.post("/api/game/fatality?is="+n).then(function(n){e(n)})}},{key:"loserWaitResultFatality",value:function(e){$.post("/api/game/isFatalityDoneForLoser").then(function(n){e(n)})}}]),n}(),i=function(){function n(){e(this,n),this.renderer=new PIXI.CanvasRenderer(window.innerWidth,window.innerHeight),document.body.appendChild(this.renderer.view),this.stage=new PIXI.Stage}return t(n,[{key:"initAnimation",value:function(n){var e=this;PIXI.loader.add("app/imgs/signs.json").load(function(){e.onAssetsLoaded(n)})}},{key:"onAssetsLoaded",value:function(n){for(var e=[],t=1;t<8;t++){var i=t<10?"0"+t:t;e.push(PIXI.Texture.fromFrame("wait"+i+".png"))}var o=new PIXI.extras.AnimatedSprite(e);o.x=window.innerWidth/2,o.y=window.innerHeight/2+50,o.anchor.set(.5),o.animationSpeed=.12,o.play(),this.stage.addChild(o),n()}},{key:"draw",value:function(){var n=this;this.renderer.render(this.stage),requestAnimationFrame(function(){n.draw()})}}]),n}(),o=null,a=null,u=null,r="none",c=null,s=null,f=new n,l=new i,d=function(){$("#buttonSearch").hide(),$("#buttonSearch").click(function(){$("#info").append("Searching enemy:..."),$("#buttonSearch").hide(),O(),m()})},h=function(){$(".buttonsChoice").hide(),$(".buttonsChoice").click(function(n){"wait-choice-fatality"!=r?($(".buttonsChoice").hide(),b(n.target.value)):R(n.target.value,function(){})})},p=function(){f.getSignIfConnectFirst(function(n){$("#info").append("Connecting done! <br/>your name: "+n.name+x),$("#buttonSearch").show()})},m=function e(){f.sendSignToFindEnemy(function(n){"playing"===n.state?(G(),y()):setTimeout(e,500)})},y=function(){f.getSignAboutUpdateGameResult(function(n){$("#info").append("ok."+x+"Find Enemy: "+n.enemy.name),g()})},g=function(){$("#info").append(x+"Round:<br/>"),O(),$(".buttonsChoice").show(),o=setInterval(w,1e3),a=setTimeout(v,7e3)},w=function(){f.getSignAboutUpdateGameResult(function(n){n.enemyMadeChoice&&(clearInterval(o),$("#info").append("Enemy made choice."))})},b=function(n){$("#info").append("You: "+n+"<br/>"),f.sendHeroChoice(n,function(n){C(n)})},v=function(){clearInterval(o),f.sendHeroChoice("timeout",function(n){C(n)})},C=function e(n){n.enemyMadeChoice?(clearTimeout(u),clearTimeout(a),G(),$("#info").append("<br/>Your: "+n.results[n.results.length-1].myChoice+" / Enemy: "+n.results[n.results.length-1].enemyChoice+" / Winner: "+n.results[n.results.length-1].winner+"<br/>"),setTimeout(F,2e3)):u=setTimeout(function(){f.getSignAboutUpdateGameResult(function(n){e(n)})},500)},F=function(){f.sendReadyForNextRound(function(n){"over"===n.state&&P(),"wait_fatality"===n.state&&(r="wait-choice-fatality",I(n),console.log("end Game")),"fatality"!==n.state&&"wait_fatality"!==n.state&&g()})},I=function(n){r="wait-choice-fatality",O(),"me"===n.winner&&(s=setTimeout(function(){k("miss")},1e4),T(),$(".buttonsChoice").show()),"enemy"===n.winner&&(s=setTimeout(function(){E()},14e3),$("#info").append("<br/>wait Death..."),A())},T=function(){c=[],$("#info").append("<br/>Fatality: ");for(var n=0;n<5;n++){var e=Math.floor(3*Math.random());0==e&&S("stone"),1==e&&S("scissors"),2==e&&S("paper")}},S=function(n){c.push(n),$("#info").append(" "+n)},R=function(n){n==c[0]?(c.splice(0,1),0==c.length&&k("done")):k("miss")},k=function(n){f.postWinnerResultFatality(n,function(n){r="none",E(n)})},A=function e(){f.loserWaitResultFatality(function(n){"none"==n.fatality&&setTimeout(e,300),"none"!=n.fatality&&(r="none",E(n))})},E=function(n){null!==s&&(clearTimeout(s),s=null),$(".buttonsChoice").hide(),G(),n&&("me"==n.winner&&"done"==n.fatality&&$("#info").append("<br/>Fatality #$%$$%%$ !!!!!!#@ !!!  <br/>"),"me"==n.winner&&"miss"==n.fatality&&$("#info").append("<br/>Fatality Crach :(  <br/>"),"enemy"==n.winner&&"done"==n.fatality&&$("#info").append("<br/> BLOOOD MORE :< FATALITY DONE <br/>"),"enemy"==n.winner&&"miss"==n.fatality&&$("#info").append("<br/> Fatality Miss  <br/>")),P()},P=function(){$("#info").append("<br/>EndBattle<br/>"),setTimeout(W,2e3)},W=function(){$("#info").html(""),p()},x="<br/>--------------------------------------------------------------<br/>",M=!1,O=function(){$("<div/>",{id:"loadBar"}).appendTo("#info"),M=setInterval(B,1e3)},B=function(){$("#loadBar").append("*")},G=function(){clearInterval(M),$("#loadBar").remove()};new Promise(function(n){l.initAnimation(n)}).then(function(){return new Promise(function(n){l.draw(),n()})}).then(function(){return new Promise(function(n){d(),h(),n()})}).then(function(){p()})}();

!function(){"use strict";var e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},i=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),t=function(){function t(){e(this,t),this.line="<br/>--------------------------------------------------------------<br/>",this.intervalAnimation=null}return i(t,[{key:"init",value:function(){$("<div id='ui'></div>").appendTo("body"),$("<div id='info'></div>").appendTo("#ui"),$("<button id='buttonSearch'>search Enemy</button>").appendTo("#ui"),$("#buttonSearch").hide(),$("<button class='buttonsChoice' value='stone'>stone</button>").appendTo("#ui"),$("<button class='buttonsChoice' value='scissors'>scissors</button>").appendTo("#ui"),$("<button class='buttonsChoice' value='paper'>paper</button>").appendTo("#ui"),$(".buttonsChoice").hide()}},{key:"clickButtonSearchEnemy",value:function(t){$("#buttonSearch").click(function(){$("#info").append("Searching enemy:..."),$("#buttonSearch").hide(),t()})}},{key:"clickButtonsChoiceHero",value:function(e,i){$(".buttonsChoice").click(function(t){i()&&$(".buttonsChoice").hide(),e(t)})}},{key:"setConnectionMessage",value:function(t){$("#info").append("Connecting done! <br/>your name: "+t+this.line)}},{key:"setMessageSearchEnemy",value:function(t){$("#info").append("ok."+this.line+"Find Enemy: "+t)}},{key:"setMessageEnemyMadeChoice",value:function(){$("#info").append("Enemy made choice.")}},{key:"setMessageChoiceHero",value:function(t){$("#info").append("You: "+t+"<br/>")}},{key:"setMeccageStartFatality",value:function(){$("#info").append("<br/>Fatality: ")}},{key:"drawRoundResult",value:function(t){$("#info").append("<br/>Your: "+t.myChoice+" / Enemy: "+t.enemyChoice+" / Winner: "+t.winner+"<br/>")}},{key:"showButtonSearch",value:function(){$("#buttonSearch").show()}},{key:"hideButtonSearch",value:function(){$("#buttonSearch").hide()}},{key:"showButtonsChoice",value:function(){$(".buttonsChoice").show()}},{key:"hideButtonsChoice",value:function(){$(".buttonsChoice").hide()}},{key:"addLine",value:function(){$("#info").append(this.line+"Round:<br/>")}},{key:"addValueFatality",value:function(t){$("#info").append(" "+t)}},{key:"setMessBeforeFatality",value:function(){$("#info").append("<br/>wait Death...")}},{key:"setMessageEnd",value:function(t){$("#info").append("<br>"+t+"</br>")}},{key:"clearScreen",value:function(){$("#info").html("")}},{key:"startAnimationWait",value:function(){var t=this;$("<div/>",{id:"loadBar"}).appendTo("#info"),this.intervalAnimation=setInterval(function(){t.waitProgress()},1e3)}},{key:"waitProgress",value:function(){$("#loadBar").append("*")}},{key:"stopAnimationWait",value:function(){clearInterval(this.intervalAnimation),$("#loadBar").remove()}}]),t}(),n=function(){function t(){e(this,t),this.responseError=function(){}}return i(t,[{key:"getSignIfConnectFirst",value:function(e){var t=this;$.get("/api/session/hello").done(function(t){e(t)}).fail(function(){t.responseError()})}},{key:"sendSignToFindEnemy",value:function(e){var t=this;$.post("/api/user/find-game").fail(function(){t.responseError()}).then(function(t){e(t)})}},{key:"getSignAboutUpdateGameResult",value:function(e){var t=this;$.get("/api/game").done(function(t){e(t)}).fail(function(){t.responseError()})}},{key:"sendHeroChoice",value:function(t,e){var i=this;$.post("/api/game/move?choice="+t).fail(function(){i.responseError()}).then(function(t){e(t)})}},{key:"sendReadyForNextRound",value:function(e){var t=this;$.post("/api/game/next-round").fail(function(){t.responseError()}).then(function(t){e(t)})}},{key:"postEnemyIsDisconnected",value:function(){var t=this;$.post("/api/game/enemy-disconnected").fail(function(){t.responseError()}).then(function(t){})}},{key:"postWinnerResultFatality",value:function(t,e){$.post("/api/game/fatality?is="+t).then(function(t){e(t)})}},{key:"loserWaitResultFatality",value:function(e){$.post("/api/game/isFatalityDoneForLoser").then(function(t){e(t)})}},{key:"setFunctionResponseError",value:function(t){this.responseError=t}}]),t}(),o=function(){function t(){e(this,t),this.renderer=new PIXI.CanvasRenderer(window.innerHeight,window.innerHeight),document.body.appendChild(this.renderer.view),this.renderer.view.style.margin="0 auto",this.stage=new PIXI.Stage,this.stepX=null,this.stepY=null,this.reckonWindowSize(),this.currentSpriteHero=null,this.currentSpriteEnemy=null}return i(t,[{key:"reckonWindowSize",value:function(){this.stepY=window.innerHeight/20,this.stepX=window.innerHeight/20}},{key:"loadAssets",value:function(t){var e=this;PIXI.loader.add("app/imgs/signs.json").add("app/imgs/fat01.json").load(function(){e.initAnimation(t)})}},{key:"initAnimation",value:function(t){for(var e=[],i=1;i<8;i++){var n=i<10?"0"+i:i;e.push(PIXI.Texture.fromFrame("wait"+n+".png"))}this.waitHero=new PIXI.extras.AnimatedSprite(e),this.waitHero.x=10*this.stepX,this.waitHero.y=12*this.stepY,this.waitHero.anchor.set(.5),this.waitHero.animationSpeed=.12,this.waitEnemy=new PIXI.extras.AnimatedSprite(e),this.waitEnemy.x=10*this.stepX,this.waitEnemy.y=8*this.stepY,this.waitEnemy.anchor.set(.5),this.waitEnemy.rotation=Math.PI,this.waitEnemy.animationSpeed=.15;for(var o=[],s=1;s<11;s++){var a=s<10?"0"+s:s;o.push(PIXI.Texture.fromFrame("coma"+a+".png"))}this.comaHero=new PIXI.extras.AnimatedSprite(o),this.comaHero.x=10*this.stepX,this.comaHero.y=12*this.stepY,this.comaHero.anchor.set(.5),this.comaHero.animationSpeed=.12,this.comaEnemy=new PIXI.extras.AnimatedSprite(o),this.comaEnemy.x=10*this.stepX,this.comaEnemy.y=8*this.stepY,this.comaEnemy.anchor.set(.5),this.comaEnemy.rotation=Math.PI,this.comaEnemy.animationSpeed=.12;for(var r=[],h=1;h<7;h++){var u=h<10?"0"+h:h;r.push(PIXI.Texture.fromFrame("choice"+u+".png"))}this.kulakHero=new PIXI.extras.AnimatedSprite(r),this.kulakHero.x=10*this.stepX,this.kulakHero.y=12*this.stepY,this.kulakHero.anchor.set(.5),this.kulakHero.animationSpeed=.12,this.kulakEnemy=new PIXI.extras.AnimatedSprite(r),this.kulakEnemy.x=10*this.stepX,this.kulakEnemy.y=8*this.stepY,this.kulakEnemy.anchor.set(.5),this.kulakEnemy.rotation=Math.PI,this.kulakEnemy.animationSpeed=.12;for(var m=[],c=1;c<4;c++){var d=c<10?"0"+c:c;m.push(PIXI.Texture.fromFrame("stone"+d+".png"))}this.stoneHero=new PIXI.extras.AnimatedSprite(m),this.stoneHero.x=10*this.stepX,this.stoneHero.y=12*this.stepY,this.stoneHero.anchor.set(.5),this.stoneHero.animationSpeed=.05,this.stoneHero.loop=!1,this.stoneEnemy=new PIXI.extras.AnimatedSprite(m),this.stoneEnemy.x=10*this.stepX,this.stoneEnemy.y=8*this.stepY,this.stoneEnemy.anchor.set(.5),this.stoneEnemy.rotation=Math.PI,this.stoneEnemy.animationSpeed=.05,this.stoneEnemy.loop=!1;for(var p=[],l=2;l<5;l++){var y=l<10?"0"+l:l;p.push(PIXI.Texture.fromFrame("paper"+y+".png"))}this.paperHero=new PIXI.extras.AnimatedSprite(p),this.paperHero.x=10*this.stepX,this.paperHero.y=12*this.stepY,this.paperHero.anchor.set(.5),this.paperHero.animationSpeed=.05,this.paperHero.loop=!1,this.paperEnemy=new PIXI.extras.AnimatedSprite(p),this.paperEnemy.x=10*this.stepX,this.paperEnemy.y=8*this.stepY,this.paperEnemy.anchor.set(.5),this.paperEnemy.rotation=Math.PI,this.paperEnemy.animationSpeed=.05,this.paperEnemy.loop=!1;for(var f=[],g=2;g<5;g++){var v=g<10?"0"+g:g;f.push(PIXI.Texture.fromFrame("scissors"+v+".png"))}this.scissorsHero=new PIXI.extras.AnimatedSprite(f),this.scissorsHero.x=10*this.stepX,this.scissorsHero.y=12*this.stepY,this.scissorsHero.anchor.set(.5),this.scissorsHero.animationSpeed=.05,this.scissorsHero.loop=!1,this.scissorsEnemy=new PIXI.extras.AnimatedSprite(f),this.scissorsEnemy.x=10*this.stepX,this.scissorsEnemy.y=8*this.stepY,this.scissorsEnemy.anchor.set(.5),this.scissorsEnemy.rotation=Math.PI,this.scissorsEnemy.animationSpeed=.05,this.scissorsEnemy.loop=!1;var E=[];E.push(PIXI.Texture.fromFrame("sign00.png")),E.push(PIXI.Texture.fromFrame("sign01.png")),E.push(PIXI.Texture.fromFrame("sign05.png")),E.push(PIXI.Texture.fromFrame("sign06.png")),E.push(PIXI.Texture.fromFrame("sign07.png")),E.push(PIXI.Texture.fromFrame("sign08.png")),this.signHeroGood=new PIXI.extras.AnimatedSprite(E),this.signHeroGood.x=10*this.stepX,this.signHeroGood.y=12*this.stepY,this.signHeroGood.anchor.set(.5),this.signHeroGood.animationSpeed=0,this.signHeroGood.loop=!1,this.signEnemyGood=new PIXI.extras.AnimatedSprite(E),this.signEnemyGood.x=10*this.stepX,this.signEnemyGood.y=8*this.stepY,this.signEnemyGood.anchor.set(.5),this.signEnemyGood.rotation=Math.PI,this.signEnemyGood.animationSpeed=0,this.signEnemyGood.loop=!1;var S=[];S.push(PIXI.Texture.fromFrame("sign02.png")),S.push(PIXI.Texture.fromFrame("sign03.png")),S.push(PIXI.Texture.fromFrame("sign04.png")),S.push(PIXI.Texture.fromFrame("sign09.png")),S.push(PIXI.Texture.fromFrame("sign10.png")),S.push(PIXI.Texture.fromFrame("sign11.png")),S.push(PIXI.Texture.fromFrame("sign12.png")),this.signHeroBad=new PIXI.extras.AnimatedSprite(S),this.signHeroBad.x=10*this.stepX,this.signHeroBad.y=12*this.stepY,this.signHeroBad.anchor.set(.5),this.signHeroBad.animationSpeed=0,this.signHeroBad.loop=!1,this.signEnemyBad=new PIXI.extras.AnimatedSprite(S),this.signEnemyBad.x=10*this.stepX,this.signEnemyBad.y=8*this.stepY,this.signEnemyBad.anchor.set(.5),this.signEnemyBad.rotation=Math.PI,this.signEnemyBad.animationSpeed=0,this.signEnemyBad.loop=!1;for(var k=[],I=0;I<8;I++){var C=I<10?"0"+I:I;k.push(PIXI.Texture.fromFrame("fat01_"+C+".png"))}this.fatality=new PIXI.extras.AnimatedSprite(k),this.fatality.x=10*this.stepX,this.fatality.y=10*this.stepY,this.fatality.anchor.set(.5),this.fatality.animationSpeed=.05,this.fatality.loop=!1,t()}},{key:"setStartSign",value:function(){this.signHeroGood.gotoAndStop(0),this.signHeroGood.x=10*this.stepX,this.signHeroGood.y=12*this.stepY,this.stage.addChild(this.signHeroGood)}},{key:"removeStartSign",value:function(){this.stage.removeChild(this.signHeroGood)}},{key:"startAnimationWait",value:function(t,e){t&&(this.waitHero.play(),this.stage.addChild(this.waitHero)),e&&(this.waitEnemy.play(),this.stage.addChild(this.waitEnemy))}},{key:"stopAnimationWait",value:function(t,e){t&&(this.waitHero.stop(),this.stage.removeChild(this.waitHero)),e&&(this.waitEnemy.stop(),this.stage.removeChild(this.waitEnemy))}},{key:"prepearCanvasToFight",value:function(t){var e=this;this.addGoodSign(!0,!0),setTimeout(function(){e.canvasReadyToFight(t)},1500)}},{key:"canvasReadyToFight",value:function(t){this.removeGoodSign(!0,!0),t()}},{key:"addGoodSign",value:function(t,e){t&&(this.signHeroGood.gotoAndStop(Math.floor(4*Math.random()+1)),this.stage.addChild(this.signHeroGood)),e&&(this.signEnemyGood.gotoAndStop(Math.floor(4*Math.random()+1)),this.stage.addChild(this.signEnemyGood))}},{key:"removeGoodSign",value:function(t,e){t&&this.stage.removeChild(this.signHeroGood),e&&this.stage.removeChild(this.signEnemyGood)}},{key:"addBadSign",value:function(t,e){t&&(this.signHeroBad.gotoAndStop(Math.floor(7*Math.random())),this.stage.addChild(this.signHeroBad)),e&&(this.signEnemyBad.gotoAndStop(Math.floor(7*Math.random())),this.stage.addChild(this.signEnemyBad))}},{key:"removeBadSign",value:function(t,e){t&&this.stage.removeChild(this.signHeroBad),e&&this.stage.removeChild(this.signEnemyBad)}},{key:"startAnimationChoice",value:function(t,e){t&&(this.kulakHero.play(),this.stage.addChild(this.kulakHero)),e&&(this.kulakEnemy.play(),this.stage.addChild(this.kulakEnemy))}},{key:"stopAnimationChoice",value:function(t,e){t&&this.kulakHero.gotoAndStop(5),e&&this.kulakEnemy.gotoAndStop(5)}},{key:"removeAnimationChoice",value:function(t,e){t&&this.stage.removeChild(this.kulakHero),e&&this.stage.removeChild(this.kulakEnemy)}},{key:"drawPlayersChoices",value:function(t){this.removeAnimationChoice(!0,!0),this.currentSpriteHero=this.getSprite(!0,!1,t.myChoice),this.stage.addChild(this.currentSpriteHero),this.isSpritePlay(t.myChoice)?this.currentSpriteHero.play():this.currentSpriteHero.gotoAndStop(1),this.currentSpriteEnemy=this.getSprite(!1,!0,t.enemyChoice),this.stage.addChild(this.currentSpriteEnemy),this.isSpritePlay(t.enemyChoice)?this.currentSpriteEnemy.play():this.currentSpriteEnemy.gotoAndStop(1)}},{key:"getSprite",value:function(t,e,i){var n=null;return t&&("stone"==i&&(n=this.stoneHero),"paper"==i&&(n=this.paperHero),"scissors"==i&&(n=this.scissorsHero),"timeout"==i&&(n=this.signHeroBad)),e&&("stone"==i&&(n=this.stoneEnemy),"paper"==i&&(n=this.paperEnemy),"scissors"==i&&(n=this.scissorsEnemy),"timeout"==i&&(n=this.signEnemyBad)),n}},{key:"isSpritePlay",value:function(t){return"timeout"!=t}},{key:"removePlayersChoices",value:function(){this.stage.removeChild(this.currentSpriteHero),this.stage.removeChild(this.currentSpriteEnemy)}},{key:"startAnimationComa",value:function(t,e){t&&(this.comaHero.play(),this.stage.addChild(this.comaHero)),e&&(this.comaEnemy.play(),this.stage.addChild(this.comaEnemy))}},{key:"stopAnimationComa",value:function(t,e){t&&(this.comaHero.stop(),this.stage.removeChild(this.comaHero)),e&&(this.comaEnemy.stop(),this.stage.removeChild(this.comaEnemy))}},{key:"startAnimationFatality",value:function(t){this.fatality.rotation=t?0:Math.PI,this.stage.addChild(this.fatality),this.fatality.gotoAndPlay(0)}},{key:"removeAnimationFatality",value:function(){this.stage.removeChild(this.fatality)}},{key:"draw",value:function(){var t=this;this.renderer.render(this.stage),requestAnimationFrame(function(){t.draw()})}}]),t}(),s=new t,a=new n,r=new o,h=null,u=null,m=null,c=null,d="none",p=null,l=function(){a.setFunctionResponseError(function(){s.setMessageEnd("!.. DISCONNECT WITH GAME/ MAY BE PAGE WAS RELOADED"),w(),r.removeBadSign(!0,!0),r.removeGoodSign(!0,!0),r.removeAnimationChoice(!0,!0),r.removePlayersChoices(),r.removeAnimationFatality(),R()})},y=function(){s.clickButtonSearchEnemy(function(){r.removeGoodSign(!0,!1),r.removeBadSign(!0,!1),r.removeAnimationFatality(),r.removeStartSign(),r.startAnimationWait(!0,!1),s.startAnimationWait(),v()})},f=function(){s.clickButtonsChoiceHero(function(t){F()?I(t.target.value):B(t.target.value)},F)},g=function(){a.getSignIfConnectFirst(function(t){s.setConnectionMessage(t.name),s.showButtonSearch()})},v=function e(){a.sendSignToFindEnemy(function(t){"playing"===t.state?(s.stopAnimationWait(),E()):setTimeout(e,500)})},E=function(){a.getSignAboutUpdateGameResult(function(t){s.setMessageSearchEnemy(t.enemy.name),r.stopAnimationWait(!0,!1),r.prepearCanvasToFight(function(){S()})})},S=function(){s.addLine(),s.startAnimationWait(),s.showButtonsChoice(),r.startAnimationChoice(!0,!0),h=setInterval(k,1e3),u=setTimeout(C,7e3)},k=function(){a.getSignAboutUpdateGameResult(function(t){t.enemyMadeChoice&&(r.stopAnimationChoice(!1,!0),s.setMessageEnemyMadeChoice(),clearInterval(h))})},I=function(t){s.setMessageChoiceHero(t),r.stopAnimationChoice(!0,!1),a.sendHeroChoice(t,function(t){H(t)})},C=function(){clearInterval(h),a.sendHeroChoice("timeout",function(t){H(t)})},H=function e(t){if("oneOfPlayersDisconnected"==t.state)return w(),void P();t.enemyMadeChoice?(w(),s.drawRoundResult(t.results[t.results.length-1]),r.drawPlayersChoices(t.results[t.results.length-1]),setTimeout(A,4e3)):m=setTimeout(function(){a.getSignAboutUpdateGameResult(function(t){e(t)})},500)},w=function(){clearInterval(h),h=null,clearTimeout(m),m=null,clearTimeout(u),u=null,s.stopAnimationWait()},A=function(){a.sendReadyForNextRound(function(t){w(),r.removePlayersChoices(),"over"===t.state&&R(),"fatality"===t.state&&R(),"wait_fatality"===t.state&&(d="wait-choice-fatality",X(t)),"fatality"!==t.state&&"wait_fatality"!==t.state&&S()})},P=function(){a.postEnemyIsDisconnected(),s.setMessageEnd("ENEMY RUN FROM BATTLE - You WIN !!"),r.stopAnimationChoice(!0,!0),r.removeAnimationChoice(!0,!0),r.removePlayersChoices(),r.addGoodSign(!0,!1),R()},F=function(){return"wait-choice-fatality"!=d},X=function(t){d="wait-choice-fatality",s.setMeccageStartFatality(),s.startAnimationWait(),"me"===t.winner&&(s.showButtonsChoice(),r.startAnimationWait(!0,!1),r.startAnimationComa(!1,!0),x(),c=setTimeout(function(){M("miss")},8e3)),"enemy"===t.winner&&(s.hideButtonsChoice(),s.setMessBeforeFatality(),r.startAnimationWait(!1,!0),r.startAnimationComa(!0,!1),b(),c=setTimeout(function(){G()},14e3))},x=function(){p=[];for(var t=0;t<5;t++){var e=Math.floor(3*Math.random());0==e&&T("stone"),1==e&&T("scissors"),2==e&&T("paper")}},T=function(t){p.push(t),s.addValueFatality(t)},B=function(t){t==p[0]?(p.splice(0,1),0==p.length&&M("done")):M("miss")},M=function(t){console.log(" postWinnerResultFatality !!!!!!!!!!!! "),a.postWinnerResultFatality(t,function(t){G(t)})},b=function e(){a.loserWaitResultFatality(function(t){"none"==t.fatality&&setTimeout(e,300),"none"!=t.fatality&&G(t)})},G=function(t){null!==c&&(clearTimeout(c),c=null),r.stopAnimationWait(!0,!0),r.stopAnimationComa(!0,!0),s.stopAnimationWait(),s.hideButtonsChoice(),t&&("me"==t.winner&&"done"==t.fatality&&(s.setMessageEnd("Fatality #$%$$%%$ !!!!!!#@ !!!"),r.startAnimationFatality(!0)),"me"==t.winner&&"miss"==t.fatality&&(s.setMessageEnd("Fatality Crach :( "),r.addBadSign(!0,!1),r.addGoodSign(!1,!0)),"enemy"==t.winner&&"done"==t.fatality&&(s.setMessageEnd("BLOOOD MORE :< FATALITY DONE "),r.startAnimationFatality(!1)),"enemy"==t.winner&&"miss"==t.fatality&&(s.setMessageEnd(" Fatality Miss  "),r.addBadSign(!1,!0),r.addGoodSign(!0,!1))),t||(s.setMessageEnd(" Fatality Miss  "),r.addBadSign(!1,!0),r.addGoodSign(!0,!1)),R()},R=function(){setTimeout(W,2e3)},W=function(){d="none",r.removeGoodSign(!1,!0),r.removeBadSign(!1,!0),s.clearScreen(),g()};new Promise(function(t){r.loadAssets(t)}).then(function(){return new Promise(function(t){s.init(),r.draw(),t()})}).then(function(){return new Promise(function(t){l(),y(),f(),t()})}).then(function(){g(),r.setStartSign()})}();

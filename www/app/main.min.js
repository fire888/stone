!function(){"use strict";var e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},n=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),t=function(){function t(){e(this,t),this.line="<br/>--------------------------------------------------------------<br/>",this.intervalAnimation=null}return n(t,[{key:"init",value:function(){$("<div id='ui'></div>").appendTo("body"),$("<div id='info'></div>").appendTo("#ui"),$("<button id='buttonSearch'>search Enemy</button>").appendTo("#ui"),$("#buttonSearch").hide(),$("<button class='buttonsChoice' value='stone'>stone</button>").appendTo("#ui"),$("<button class='buttonsChoice' value='scissors'>scissors</button>").appendTo("#ui"),$("<button class='buttonsChoice' value='paper'>paper</button>").appendTo("#ui"),$(".buttonsChoice").hide()}},{key:"clickButtonSearchEnemy",value:function(t){$("#buttonSearch").click(function(){$("#info").append("Searching enemy:..."),$("#buttonSearch").hide(),t()})}},{key:"clickButtonsChoiceHero",value:function(e,n){$(".buttonsChoice").click(function(t){n()&&$(".buttonsChoice").hide(),e(t)})}},{key:"startAnimationWait",value:function(){var t=this;$("<div/>",{id:"loadBar"}).appendTo("#info"),this.intervalAnimation=setInterval(function(){t.waitProgress()},1e3)}},{key:"waitProgress",value:function(){$("#loadBar").append("*")}},{key:"stopAnimationWait",value:function(){clearInterval(this.intervalAnimation),$("#loadBar").remove()}}]),t}(),i=function(){function t(){e(this,t)}return n(t,[{key:"sendSignToFindEnemy",value:function(e){$.post("/api/user/find-game").then(function(t){e(t)})}},{key:"getSignIfConnectFirst",value:function(e){$.get("/api/session/hello").done(function(t){e(t)})}},{key:"getSignAboutUpdateGameResult",value:function(e){$.get("/api/game").done(function(t){e(t)})}},{key:"sendHeroChoice",value:function(t,e){console.log(t),$.post("/api/game/move?choice="+t).then(function(t){e(t)})}},{key:"sendReadyForNextRound",value:function(e){$.post("/api/game/next-round").then(function(t){e(t)})}},{key:"postWinnerResultFatality",value:function(t,e){$.post("/api/game/fatality?is="+t).then(function(t){e(t)})}},{key:"loserWaitResultFatality",value:function(e){$.post("/api/game/isFatalityDoneForLoser").then(function(t){e(t)})}}]),t}(),o=function(){function t(){e(this,t),this.renderer=new PIXI.CanvasRenderer(window.innerHeight,window.innerHeight),document.body.appendChild(this.renderer.view),this.renderer.view.style.margin="0 auto",this.stage=new PIXI.Stage,this.stepX=null,this.stepY=null,this.reckonWindowSize()}return n(t,[{key:"reckonWindowSize",value:function(){this.stepY=window.innerHeight/20,this.stepX=window.innerHeight/20}},{key:"initAnimation",value:function(t){var e=this;PIXI.loader.add("app/imgs/signs.json").load(function(){e.onAssetsLoaded(t)})}},{key:"onAssetsLoaded",value:function(t){for(var e=[],n=1;n<8;n++){var i=n<10?"0"+n:n;e.push(PIXI.Texture.fromFrame("wait"+i+".png"))}this.waitHero=new PIXI.extras.AnimatedSprite(e),this.waitHero.x=window.innerWidth/2,this.waitHero.y=window.innerHeight/2+50,this.waitHero.anchor.set(.5),this.waitHero.animationSpeed=.12;for(var o=[],a=1;a<7;a++){var s=a<10?"0"+a:a;o.push(PIXI.Texture.fromFrame("choice"+s+".png"))}this.choiceHero=new PIXI.extras.AnimatedSprite(o),this.choiceHero.x=10*this.stepX,this.choiceHero.y=12*this.stepY,this.choiceHero.anchor.set(.5),this.choiceHero.animationSpeed=.12,this.choiceEnemy=new PIXI.extras.AnimatedSprite(o),this.choiceEnemy.x=10*this.stepX,this.choiceEnemy.y=8*this.stepY,this.choiceEnemy.rotation=Math.PI,this.choiceEnemy.anchor.set(.5),this.choiceEnemy.animationSpeed=.12;for(var r=[],u=1;u<4;u++){var h=u<10?"0"+u:u;r.push(PIXI.Texture.fromFrame("stone"+h+".png"))}this.stoneHero=new PIXI.extras.AnimatedSprite(r),this.stoneHero.x=10*this.stepX,this.stoneHero.y=12*this.stepY,this.stoneHero.anchor.set(.5),this.stoneHero.animationSpeed=.05,this.stoneHero.loop=!1;for(var c=[],l=0;l<13;l++){var d=l<10?"0"+l:l;c.push(PIXI.Texture.fromFrame("sign"+d+".png"))}this.signHero=new PIXI.extras.AnimatedSprite(c),this.signHero.x=12*this.stepX,this.signHero.y=10*this.stepY,this.signHero.anchor.set(.5),this.signHero.animationSpeed=.05,this.signEnemy=new PIXI.extras.AnimatedSprite(c),this.signEnemy.x=8*this.stepX,this.signEnemy.y=10*this.stepY,this.signEnemy.rotation=Math.PI,this.signEnemy.anchor.set(.5),this.signEnemy.animationSpeed=.05,t()}},{key:"setStartSign",value:function(){this.signHero.gotoAndStop(0),this.signHero.x=window.innerWidth/2,this.signHero.y=window.innerHeight/2+100,this.stage.addChild(this.signHero)}},{key:"removeStartSign",value:function(){this.stage.removeChild(this.signHero)}},{key:"startHeroWaitAnimation",value:function(){this.waitHero.play(),this.stage.addChild(this.waitHero)}},{key:"stopHeroWaitAnimation",value:function(){this.waitHero.stop(),this.stage.removeChild(this.waitHero)}},{key:"prepearCanvasToFight",value:function(t){var e=this;this.signHero.gotoAndStop(Math.floor(12*Math.random()+1)),this.stage.addChild(this.signHero),this.signEnemy.gotoAndStop(Math.floor(12*Math.random()+1)),this.stage.addChild(this.signEnemy),setTimeout(function(){e.canvasReadyToFight(t)},1500)}},{key:"canvasReadyToFight",value:function(t){this.stage.removeChild(this.signHero),this.stage.removeChild(this.signEnemy),t()}},{key:"startAnimationChoice",value:function(t,e){t&&(this.choiceHero.play(),this.stage.addChild(this.choiceHero)),e&&(this.choiceEnemy.play(),this.stage.addChild(this.choiceEnemy))}},{key:"stopAnimationChoice",value:function(t,e){t&&this.choiceHero.gotoAndStop(5),e&&this.choiceEnemy.gotoAndStop(5)}},{key:"drawPlayersChoices",value:function(t,e){this.stage.removeChild(this.choiceEnemy),this.stage.removeChild(this.choiceHero)}},{key:"getSprite",value:function(t,e,n){var i=null;return t&&("stone"==n&&(i=this.stoneHero),"paper"==n&&(i=this.paperHero),"scissors"==n&&(i=this.scissorsHero)),i}},{key:"draw",value:function(){var t=this;this.renderer.render(this.stage),requestAnimationFrame(function(){t.draw()})}}]),t}(),a=new t,s=new i,r=new o,u=null,h=null,c=null,l="none",d=null,f=null,p=function(){a.clickButtonSearchEnemy(function(){r.removeStartSign(),r.startHeroWaitAnimation(),a.startAnimationWait(),g()})},m=function(){a.clickButtonsChoiceHero(function(t){k()?b(t.target.value):F(t.target.value)},k)},y=function(){s.getSignIfConnectFirst(function(t){$("#info").append("Connecting done! <br/>your name: "+t.name+a.line),$("#buttonSearch").show()})},g=function e(){s.sendSignToFindEnemy(function(t){"playing"===t.state?(a.stopAnimationWait(),v()):setTimeout(e,500)})},v=function(){s.getSignAboutUpdateGameResult(function(t){$("#info").append("ok."+a.line+"Find Enemy: "+t.enemy.name),r.stopHeroWaitAnimation(),r.prepearCanvasToFight(function(){w()})})},w=function(){$("#info").append(a.line+"Round:<br/>"),a.startAnimationWait(),r.startAnimationChoice(!0,!0),$(".buttonsChoice").show(),u=setInterval(H,1e3),h=setTimeout(C,7e3)},H=function(){s.getSignAboutUpdateGameResult(function(t){t.enemyMadeChoice&&(r.stopAnimationChoice(!1,!0),clearInterval(u),$("#info").append("Enemy made choice."))})},b=function(t){$("#info").append("You: "+t+"<br/>"),r.stopAnimationChoice(!0,!1),s.sendHeroChoice(t,function(t){S(t)})},C=function(){clearInterval(u),s.sendHeroChoice("timeout",function(t){S(t)})},S=function e(t){t.enemyMadeChoice?(clearTimeout(c),clearTimeout(h),a.stopAnimationWait(),$("#info").append("<br/>Your: "+t.results[t.results.length-1].myChoice+" / Enemy: "+t.results[t.results.length-1].enemyChoice+" / Winner: "+t.results[t.results.length-1].winner+"<br/>"),r.drawPlayersChoices(t.results[t.results.length-1].myChoice,t.results[t.results.length-1].enemyChoice),setTimeout(A,2e3)):c=setTimeout(function(){s.getSignAboutUpdateGameResult(function(t){e(t)})},500)},A=function(){s.sendReadyForNextRound(function(t){"over"===t.state&&X(),"wait_fatality"===t.state&&(l="wait-choice-fatality",I(t),console.log("end Game")),"fatality"!==t.state&&"wait_fatality"!==t.state&&w()})},k=function(){return"wait-choice-fatality"!=l},I=function(t){l="wait-choice-fatality",a.startAnimationWait(),"me"===t.winner&&(f=setTimeout(function(){P("miss")},1e4),T(),$(".buttonsChoice").show()),"enemy"===t.winner&&(f=setTimeout(function(){x()},14e3),$("#info").append("<br/>wait Death..."),W())},T=function(){d=[],$("#info").append("<br/>Fatality: ");for(var t=0;t<5;t++){var e=Math.floor(3*Math.random());0==e&&E("stone"),1==e&&E("scissors"),2==e&&E("paper")}},E=function(t){d.push(t),$("#info").append(" "+t)},F=function(t){t==d[0]?(d.splice(0,1),0==d.length&&P("done")):P("miss")},P=function(t){s.postWinnerResultFatality(t,function(t){l="none",x(t)})},W=function e(){s.loserWaitResultFatality(function(t){"none"==t.fatality&&setTimeout(e,300),"none"!=t.fatality&&(l="none",x(t))})},x=function(t){null!==f&&(clearTimeout(f),f=null),$(".buttonsChoice").hide(),a.stopAnimationWait(),t&&("me"==t.winner&&"done"==t.fatality&&$("#info").append("<br/>Fatality #$%$$%%$ !!!!!!#@ !!!  <br/>"),"me"==t.winner&&"miss"==t.fatality&&$("#info").append("<br/>Fatality Crach :(  <br/>"),"enemy"==t.winner&&"done"==t.fatality&&$("#info").append("<br/> BLOOOD MORE :< FATALITY DONE <br/>"),"enemy"==t.winner&&"miss"==t.fatality&&$("#info").append("<br/> Fatality Miss  <br/>")),X()},X=function(){$("#info").append("<br/>EndBattle<br/>"),setTimeout(R,2e3)},R=function(){$("#info").html(""),y()};new Promise(function(t){r.initAnimation(t)}).then(function(){return new Promise(function(t){a.init(),r.draw(),t()})}).then(function(){return new Promise(function(t){p(),m(),t()})}).then(function(){y(),r.setStartSign()})}();
